(function(a){return a(a)})(function(f,z,p){var af=function(an){return an.split(/\s+/)},C=function(an,ao){return ao&&ao.call(an,an)||an},o=function(an){throw new Error(an)},c=z||(function(){for(var an=[],ap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$_",ao=21,aq;ao>=0;--ao){an.push(ap.charAt(Math.random()*64>>>0))}return an.join("")})(),W=(function(an){return function(ao){return[ao||"",(++an).toString(36),c].join("_")}})(0),V=function(an){return an.substr(an.length-22)===c},i=function(ao,an){return function(){return ao.apply(an,arguments)}},N=function(ar,ao){for(var ap=0,aq=[],an=ao.length;ap<an;++ap){aq.push(ar(ao[ap],ap))}return aq},w=function(ao,an){return N(function(ap){return ap instanceof Array?w(ao,ap):ao(ap)})},ad=function(aq){for(var ap=0,ao=af(aq),ar={},an=ao.length;ap<an;++ap){ar[ao[ap]]=true}return s(ar)},ab=(function(ao){for(var an in ao){if(ao.hasOwnProperty(an)){return true}}})({toString:true})?function(ar){for(var aq=1,an=arguments.length,ap;aq<an;++aq){if(ap=arguments[aq]){for(var ao in ap){if(g(ap,ao)){ar[ao]=ap[ao]}}}}return ar}:function(ar){for(var aq=1,an=arguments.length,ap;aq<an;++aq){if(ap=arguments[aq]){for(var ao in ap){if(g(ap,ao)){ar[ao]=ap[ao]}}if(ap.toString&&!/\[native code\]/.test(ap.toString.toString())){ar.toString=ap.toString}}}return ar},aa=W("hash"),s=function(ap){var an=0;for(var ao in ap){l.call(ap,ao)&&(an=ao.length>an?ao.length:an)}ap[aa]=an;return ap},g=function(ao,an){return an!=null&&!(an.length>ao[aa])&&l.call(ao,an)},l=Object.prototype.hasOwnProperty,ae=function(){var an=function(){return an.init.apply(an,arguments)};return an},ag=typeof caterwaul==="undefined"?p:caterwaul,am=C(ae(),function(){this.deglobalize=function(){caterwaul=ag;return am};ab(this,{merge:ab,map:N,rmap:w,gensym:W,is_gensym:V})}),al=ad(". new ++ -- u++ u-- u+ u- typeof u~ u! ! * / % + - << >> >>> < > <= >= instanceof in == != === !== & ^ | && || ? = += -= *= /= %= &= |= ^= <<= >>= >>>= : , return throw case var const break continue void else u; ;"),S=function(aq){for(var ap=0,ao=[false];ap<8;++ap){ao.push.apply(ao,ao)}for(var ap=0,an=aq.length;ap<an;++ap){ao[aq.charCodeAt(ap)]=true}return ao},aj=S(".0123456789"),U=S("0123456789"),y=S("0123456789abcdefABCDEFx"),L=S("eE"),j=S(" \n\r\t"),t=S("()[]{}"),r=S("([{"),x=S("+-*/%&|^!~=<>?:;.,"),J=S("\n\r"),k=S("gims"),O=S("'\"/"),n="/".charCodeAt(0),R="*".charCodeAt(0),m="\\".charCodeAt(0),Z="x".charCodeAt(0),M=".".charCodeAt(0),T="0".charCodeAt(0),ai=ad("++ --"),X=S("$_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"),K=N(ad,["function","( [ . [] ()","new delete","u++ u-- ++ -- typeof u~ u! u+ u-","* / %","+ -","<< >> >>>","< > <= >= instanceof in","== != === !==","&","^","|","&&","||","case","?","= += -= *= /= %= &= |= ^= <<= >>= >>>=",":",",","return throw break continue void","var const","if else try catch finally for switch with while do",";"]),H=ad("= += -= *= /= %= &= ^= |= <<= >>= >>>= ~ ! new typeof u+ u- -- ++ u-- u++ ? if else function try catch finally for switch case with while do"),F=(function(ap){for(var ar={},aq=0,an=ap.length;aq<an;++aq){for(var ao in ap[aq]){g(ap[aq],ao)&&(ar[ao]=aq)}}return s(ar)})(K),v=(function(ap){for(var ar=[],at=0,an=ap.length,aq=null;aq=ap[at],ar[at]=true,at<an;++at){for(var ao in aq){if(g(aq,ao)&&(ar[at]=ar[at]&&!g(H,ao))){break}}}return ar})(K),B=ad("[] . () * / % + - << >> >>> < > <= >= instanceof in == != === !== & ^ | && || = += -= *= /= %= &= |= ^= <<= >>= >>>= , : ;"),Y=s({"function":2,"if":1,"do":1,"catch":1,"try":1,"for":1,"while":1,"with":1,"switch":1}),Q=s({"if":"else","do":"while","catch":"finally","try":"catch"}),D=ad("[] ()"),ah=ad("return throw break continue else"),E=ad("u+ u- u! u~ u++ u-- new typeof finally case var const void delete"),h=ad("; {"),ac=ad("i;"),I=ad("++ --"),q=s({"(":")","[":"]","{":"}","?":":"}),G=ad("[ ("),P=ad("?"),e=ad("function if for while catch void delete new typeof in instanceof"),A=ad("function"),u=am.syntax_common={_replace:function(an){return(an.l=this.l)&&(this.l.r=an),(an.r=this.r)&&(this.r.l=an),this},_append_to:function(an){return an&&an._append(this),this},_reparent:function(an){return this.p&&this.p[0]===this&&(this.p[0]=an),this},_fold_l:function(an){return this._append(this.l&&this.l._unlink(this)||a)},_append:function(an){return(this[this.length++]=an)&&(an.p=this),this},_fold_r:function(an){return this._append(this.r&&this.r._unlink(this)||a)},_sibling:function(an){return an.p=this.p,(this.r=an).l=this},_fold_lr:function(){return this._fold_l()._fold_r()},_fold_rr:function(){return this._fold_r()._fold_r()},_wrap:function(an){return an.p=this._replace(an).p,this._reparent(an),delete this.l,delete this.r,this._append_to(an)},_unlink:function(an){return this.l&&(this.l.r=this.r),this.r&&(this.r.l=this.l),delete this.l,delete this.r,this._reparent(an)},pop:function(){return --this.length,this},push:function(an){return this[this.length++]=an||a,this},id:function(){var an=W("id");return(this.id=function(){return an})()},is_caterwaul_syntax:true,each:function(ap){for(var ao=0,an=this.length;ao<an;++ao){ap(this[ao],ao)}return this},map:function(ap){for(var aq=new this.constructor(this),ao=0,an=this.length;ao<an;++ao){aq.push(ap(this[ao],ao)||this[ao])}return aq},reach:function(an){an(this);this.each(function(ao){ao.reach(an)});return this},rmap:function(ao){var an=ao(this);return !an||an===this?this.map(function(ap){return ap.rmap(ao)}):an.rmap===p?new this.constructor(an):an},clone:function(){return this.rmap(function(){return false})},collect:function(ao){var an=[];this.reach(function(ap){ao(ap)&&an.push(ap)});return an},replace:function(an){var ao;return l.call(an,this.data)&&(ao=an[this.data])?ao.constructor===String?C(this.map(function(ap){return ap.replace(an)}),function(){this.data=ao}):ao:this.map(function(ap){return ap.replace(an)})},repopulated_with:function(an){return new this.constructor(this.data,an)},with_data:function(an){return new this.constructor(an,Array.prototype.slice.call(this))},change:function(ao,an){return C(new this.constructor(this.data,Array.prototype.slice.call(this)),function(ap){ap[ao]=an})},compose_single:function(an,ao){return this.change(an,ao(this[an]))},slice:function(ao,an){return new this.constructor(this.data,Array.prototype.slice.call(this,ao,an))},traverse:function(an){an({entering:this});an({exiting:this.each(function(ao){ao.traverse(an)})});return this},flatten:function(an){an=an||this.data;return an!==this.data?this.as(an):!(g(B,an)&&this.length)?this:g(H,an)?C(new this.constructor(an),i(function(ap){for(var ao=this;ao&&ao.data===an;ao=ao[1]){ap.push(ao[0])}ap.push(ao)},this)):C(new this.constructor(an),i(function(aq){for(var ao=this,ap=[];ao.data===an;ao=ao[0]){ao[1]&&ap.push(ao[1])}ap.push(ao);for(ao=ap.length-1;ao>=0;--ao){aq.push(ap[ao])}},this))},unflatten:function(){var ao=this,an=g(H,this.data);return this.length<=2?this:C(new this.constructor(this.data),function(ar){if(an){for(var aq=0,ap=ao.length-1;aq<ap;++aq){ar=ar.push(ao[aq]).push(aq<ap-2?new ao.constructor(ao.data):ao[aq])[1]}}else{for(var aq=ao.length-1;aq>=1;--aq){ar=ar.push(aq>1?new ao.constructor(ao.data):ao[0]).push(ao[aq])[0]}}})},as:function(an){return this.data===an?this:new this.constructor(an).push(this)},bindings:function(ao){var an=ao||{};this.reach(function(ap){if(ap.binds_a_value){an[ap.data]=ap.value}});return an},match:function(ap,aq){ap=ap.constructor===String?am.parse(ap):ap;aq||(aq={_:ap});if(this.is_wildcard()){return aq[this.data]=ap,aq}else{if(this.length===ap.length&&this.data===ap.data){for(var ao=0,an=this.length;ao<an;++ao){if(!this[ao].match(ap[ao],aq)){return null}}return aq}}},toString:function(){var an=[""];this.serialize(an);return an.join("")},structure:function(){if(this.length){return"("+['"'+this.data+'"'].concat(N(function(an){return an.structure()},this)).join(" ")+")"}else{return this.data}}};am.syntax_subclass=function(ap){var ao=Array.prototype.slice.call(arguments,1),an=function(){return ap.apply(this,arguments)};ab.apply(this,[an.prototype,u].concat(ao));an.prototype.constructor=an;return an};var b=am.parse_hex=function(aq){for(var an=0,ap=0,ao=aq.length,ar;ap<ao;++ap){an*=16,an+=(ar=aq.charCodeAt(ap))<=58?ar-48:(ar&95)-55}return an},ak=am.parse_octal=function(aq){for(var an=0,ap=0,ao=aq.length;ap<ao;++ap){an*=8,an+=aq.charCodeAt(ap)-48}return an},d=am.unescape_string=function(ar){for(var aq=0,at,ao=ar.length,an=[],ap=false;aq<ao;++aq){if(ap){ap=false,an.push((at=ar.charAt(aq))==="\\"?"\\":at==="n"?"\n":at==="r"?"\r":at==="b"?"\b":at==="f"?"\f":at==="0"?"\u0000":at==="t"?"\t":at==="v"?"\v":at==='"'||at==="'"?at:at==="x"?String.fromCharCode(b(ar.substring(aq,++aq+1))):at==="u"?String.fromCharCode(b(ar.substring(aq,(aq+=3)+1))):String.fromCharCode(ak(ar.substring(aq,(aq+=2)+1))))}else{if((at=ar.charAt(aq))==="\\"){ap=true}else{an.push(at)}}}return an.join("")};am.javascript_tree_type_methods={is_string:function(){return/['"]/.test(this.data.charAt(0))},as_escaped_string:function(){return this.data.substr(1,this.data.length-2)},is_number:function(){return/^-?(0x|\d|\.\d+)/.test(this.data)},as_number:function(){return Number(this.data)},is_boolean:function(){return this.data==="true"||this.data==="false"},as_boolean:function(){return this.data==="true"},is_regexp:function(){return/^\/./.test(this.data)},as_escaped_regexp:function(){return this.data.substring(1,this.data.lastIndexOf("/"))},is_array:function(){return this.data==="["},as_unescaped_string:function(){return d(this.as_escaped_string())},is_wildcard:function(){return this.data.charCodeAt(0)===95},is_identifier:function(){return this.length===0&&/^[A-Za-z_$]\w*$/.test(this.data)&&!this.is_boolean()&&!this.is_null_or_undefined()&&!g(al,this.data)},has_grouped_block:function(){return g(Y,this.data)},is_block:function(){return g(h,this.data)},is_blockless_keyword:function(){return g(ah,this.data)},is_null_or_undefined:function(){return this.data==="null"||this.data==="undefined"},is_constant:function(){return this.is_number()||this.is_string()||this.is_boolean()||this.is_regexp()||this.is_null_or_undefined()},left_is_lvalue:function(){return/=$/.test(this.data)||/\+\+$/.test(this.data)||/--$/.test(this.data)},is_empty:function(){return !this.length},has_parameter_list:function(){return this.data==="function"||this.data==="catch"},has_lvalue_list:function(){return this.data==="var"||this.data==="const"},is_dereference:function(){return this.data==="."||this.data==="[]"},is_invocation:function(){return this.data==="()"},is_contextualized_invocation:function(){return this.is_invocation()&&this[0].is_dereference()},is_invisible:function(){return g(ac,this.data)},is_binary_operator:function(){return g(B,this.data)},is_prefix_unary_operator:function(){return g(E,this.data)},is_postfix_unary_operator:function(){return g(I,this.data)},is_unary_operator:function(){return this.is_prefix_unary_operator()||this.is_postfix_unary_operator()},accepts:function(an){return g(Q,this.data)&&Q[this.data]===(an.data||an)}};am.javascript_tree_serialization_methods={ends_with_block:function(){var an=this[Y[this.data]];return this.data==="{"||g(Y,this.data)&&(this.data!=="function"||this.length===3)&&an&&an.ends_with_block()},serialize:function(aq){var ao=this.length,ar=this.data,an=";\n",ap=function(at){if(X[aq[aq.length-1].charCodeAt(0)]===X[at.charCodeAt(0)]){aq.push(" ",at)}else{aq.push(at)}};switch(ao){case 0:if(g(ah,ar)){return ap(ar.replace(/^u/,""))}else{if(g(q,ar)){return ap(ar),ap(q[ar])}else{return ap(ar)}}case 1:if(g(E,ar)||g(ah,ar)){return ap(ar.replace(/^u/,"")),this[0].serialize(aq)}else{if(g(q,ar)){return ap(ar),this[0].serialize(aq),ap(q[ar])}else{if(g(B,ar)){return ap("/* unary "+ar+" node */"),this[0].serialize(aq)}else{return this[0].serialize(aq),ap(ar)}}}case 2:if(g(D,ar)){return this[0].serialize(aq),ap(ar.charAt(0)),this[1].serialize(aq),ap(ar.charAt(1))}else{if(g(Y,ar)){return ap(ar),this[0].serialize(aq),this[1].serialize(aq)}else{if(g(ac,ar)){return this[0].serialize(aq),this[1].serialize(aq)}else{if(ar===";"){return this[0].serialize(aq),ap(an),this[1].serialize(aq)}else{return this[0].serialize(aq),ap(ar),this[1].serialize(aq)}}}}default:if(g(P,ar)){return this[0].serialize(aq),ap(ar),this[1].serialize(aq),ap(":"),this[2].serialize(aq)}else{if(g(Y,ar)){return this.accepts(this[2])&&!this[1].ends_with_block()?(ap(ar),this[0].serialize(aq),this[1].serialize(aq),ap(an),this[2].serialize(aq)):(ap(ar),this[0].serialize(aq),this[1].serialize(aq),this[2].serialize(aq))}else{return this.unflatten().serialize(aq)}}}}};am.ref=am.syntax_subclass(function(ao,an){if(ao instanceof this.constructor){this.value=ao.value,this.data=ao.data}else{this.value=ao,this.data=W(an&&an.constructor===String?an:"ref")}},am.javascript_tree_type_methods,am.javascript_tree_serialization_methods,{binds_a_value:true,length:0},{replace:function(an){var ao;return l.call(an,this.data)&&(ao=an[this.data])?ao.constructor===String?C(new this.constructor(this.value),function(){this.data=ao}):ao:this}});am.syntax=am.syntax_subclass(function(at){if(at instanceof this.constructor){this.data=at.data,this.length=0}else{this.data=at&&at.toString();this.length=0;for(var aq=1,an=arguments.length,ap;ap=arguments[aq],aq<an;++aq){for(var ao=0,av=ap.length,ar,au;ap instanceof Array?(ar=ap[ao],ao<av):(ar=ap,!ao);++ao){this._append((au=ar.constructor)===String||au===Number||au===Boolean?new this.constructor(ar):ar)}}}},am.javascript_tree_type_methods,am.javascript_tree_serialization_methods);var a=am.empty=new am.syntax("");am.parse=function(aE){if(aE.constructor===am.syntax){return aE}var aH=aE.toString(),aB=0,aT=0,aK=true,aU=false,aJ=false,aw=false,aI=0,aG="",aP=0,aN=aH.length,ao=function(aX){return aH.charCodeAt(aX)},ax=[],aq=null,an=null,aA=null,at=N(function(){return[]},K),ap=[],ay=[a],aR=function(aX){return ay.push(aX),aX},av=function(aX){return an?an._sibling(an=aX):(an=aX._append_to(aA)),aR(aX)},aM=this.syntax;if(aN===0){return a}while((aB=aP)<aN){while(j[aT=ao(aP)]&&aP<aN){aB=++aP}aU=aw=aJ=aG=false;if(t[aT]){aG=!!++aP;aK=r[aT]}else{if(aT===n&&ao(aP+1)===R&&(aP+=2)){while(++aP<aN&&ao(aP)!==n||ao(aP-1)!==R){}aG=!++aP}else{if(aT===n&&ao(aP+1)===n){while(++aP<aN&&!J[ao(aP)]){}aG=false}else{if(O[aT]&&(aI=aT)&&aK&&!(aK=!(aG=aH.charAt(aP)))){while(++aP<aN&&(aT=ao(aP))!==aI||aU){aU=!aU&&aT===m}while(++aP<aN&&k[ao(aP)]){}aG=true}else{if(aT===T&&y[ao(aP+1)]){while(++aP<aN&&y[ao(aP)]){}aK=!(aG=true)}else{if(aj[aT]&&(aT!==M||U[ao(aP+1)])){while(++aP<aN&&(U[aT=ao(aP)]||(aJ^(aJ|=aT===M))||(aw^(aw|=L[aT]&&++aP)))){}while(aP<aN&&U[ao(aP)]){++aP}aK=!(aG=true)}else{if(x[aT]&&(aG=aK?"u":"",aK=true)){while(aP<aN&&x[ao(aP)]&&g(al,aG+aH.charAt(aP))){aG+=aH.charAt(aP++)}aK=!g(ai,aG)}else{while(++aP<aN&&X[ao(aP)]){}aK=g(al,aG=aH.substring(aB,aP))}}}}}}}if(aP===aB){throw new Error('Caterwaul lex error at "'+aH.substr(aB,40)+'" with leading context "'+aH.substr(aB-40,40)+'" (probably a Caterwaul bug)')}if(aG===false){continue}aG=aG===true?aH.substring(aB,aP):aG==="u;"?";":aG;aG===aq?(ax.pop(),aq=ax[ax.length-1],an=an?an.p:aA,aA=null):(g(q,aG)?(ax.push(aq=q[aG]),aA=av(aR(new aM(aG))),an=null):av(aR(new aM(aG))),g(F,aG)&&at[F[aG]].push(an||aA));aK|=aG===")"&&an.l&&g(Y,an.l.data)}for(var aP=0,aN=at.length,aC,aW;aW=at[aP],aC=v[aP],aP<aN;++aP){for(var aO=aC?0:aW.length-1,aF=aW.length,az=aC?1:-1,aL,aV,aD;aC?aO<aF:aO>=0;aO+=az){if(g(B,aV=(aL=aW[aO]).data)){aL._fold_lr()}else{if(g(G,aV)&&aL.l&&!((aD=aL.l.l)&&g(Y,aD.data))&&(aL.l.data==="."||(aL.l.data==="function"&&aL.l.length===2)||!(g(al,aL.l.data)||g(e,aL.l.data)))){ap.push(aL.l._wrap(aR(new aM(aV+q[aV]))).p._fold_r())}else{if(g(I,aV)){aL._fold_l()}else{if(g(E,aV)){aL._fold_r()}else{if(g(P,aV)){aL._fold_lr();var aS=aL[1];aL[1]=aL[0];aL[0]=aS}else{if(g(Y,aV)&&aL.r&&aL.r.data!==":"){for(var au=0,aQ=Y[aV];au<aQ&&aL.r&&!g(h,aL.r.data);++au){aL._fold_r()}aL.r&&(aL.r.data===";"?aL.push(a):aL._fold_r());if(g(Q,aV)&&Q[aV]===(aL.r&&aL.r.r&&aL.r.r.data)){aL._fold_r().pop()._fold_r()}else{if(g(Q,aV)&&Q[aV]===(aL.r&&aL.r.data)){aL._fold_r()}}}else{if(g(ah,aV)){aL.r&&aL.r.data!==";"&&aL._fold_r()}}}}}}}}}for(var aP=ay.length-1,aW;aP>=0;--aP){(aW=ay[aP]).r&&aW._wrap(aR(new aM("i;"))).p._fold_r()}for(var aP=0,aN=ap.length,aW,ar;aP<aN;++aP){(ar=(aW=ap[aP])[1]=aW[1][0]||a)&&(ar.p=aW)}while(an.p){an=an.p}for(var aP=ay.length-1,aW;aP>=0;--aP){delete (aW=ay[aP]).p,delete aW.l,delete aW.r}return an};(function(){var an=am.parse("var _bindings; return(_expression)"),ap=am.parse("_variable = _base._variable"),ao=am.parse("undefined = void(0)");am.compile=function(aC,aw,aB){aB=ab({gensym_renaming:true},aB);var at=ab({},this._environment||{},aw||{},aC.bindings()),ay=[ao],aA=W("base");for(var av in at){if(l.call(at,av)&&av!=="this"){ay.push(ap.replace({_variable:av,_base:aA}))}}var az=new this.syntax(",",ay).unflatten(),aq=an.replace({_bindings:az,_expression:aC});if(aB.gensym_renaming){var au=this.gensym_rename_table(aq);for(var av in at){l.call(at,av)&&(at[au[av]||av]=at[av])}aq=aq.replace(au);aA=au[aA]}var ar=aq.toString();try{return(new Function(aA,ar)).call(at["this"],at)}catch(ax){throw new Error((ax.message||ax)+" while compiling "+ar)}};am.gensym_rename_table=function(az){var ay={},aw=[];az.reach(function(aA){var aB=aA.data;if(V(aB)){ay[aB]||aw.push(aB)}ay[aB]=aB.replace(/^(.*)_[a-z0-9]+_.{22}$/,"$1")||"anon"});var aq={},ax=function(aA){if(!(aA in ay)){return aA}var aB=aq[aA]||0;while(ay[aA+(++aB).toString(36)]){}return aA+(aq[aA]=aB).toString(36)};for(var ar={},au=0,at=aw.length,av;au<at;++au){ar[av=aw[au]]||(ay[ar[av]=ax(ay[av])]=true)}return ar}})();am.init=function(ao){var an=function(ar,ap,aq){return ar.constructor===Function||ar.constructor===String?am.compile(an.call(an,am.parse(ar)),ap,aq):ao?ar.rmap(function(at){return ao.call(an,at,ap,aq)}):ar};an.global=am;an.macroexpander=ao;return an};am.initializer=f;am.clone=function(){return C(f(f,c).deglobalize(),function(){for(var an in am){this[an]||(this[an]=am[an])}})};return caterwaul=am});(caterwaul.std_initializer=function(){(function(c){var b=function(g){var d=function(h){if(h.constructor===Array){for(var k=0,j=h.length,m=[];k<j;++k){m.push(d(h[k]))}return function(l){for(var o=m.length-1,q;o>=0;--o){if(q=m[o].call(this,l)){return q}}}}else{return h.constructor===String?d(c.parse(h)):h.constructor===c.syntax?g.call(this,h):h}};return d};c.pattern=b(function(d){return function(g){return d.match(g)}});c.expander=b(function(d){return function(g){return d.replace(g)}});c.alternatives=b(function(d){throw new Error("must use replacer functions with caterwaul.alternatives()")});c.reexpander=function(g){var d=c.expander(g);return function(h){var i=d.call(this,h);return i&&this(i)}};var a=function(d){return function(h,j){var i=c.pattern(h),g=d(j);return function(k){var l=i.call(this,k);return l&&g.call(this,l)}}};c.replacer=a(c.expander);c.rereplacer=a(c.reexpander);c.macroexpand=function(d){return c(c.alternatives(Array.prototype.slice.call(arguments,1)))(d)}})(caterwaul);(function(a){a.anonymizer=function(){for(var d={},c=0,b=arguments.length;c<b;++c){d[arguments[c]]=a.gensym(arguments[c])}return function(g){return a.parse(g).replace(d)}}})(caterwaul);(function(a){a.js=function(c){var j=function(L){var T=L.data,I=T.charAt(0),N=a.syntax;if(I!=="'"&&I!=='"'||!/#\{[^\}]+\}/.test(T)){return false}for(var M=[],U=[],P=1,O=T.length-1,S=0,Q=false,J=1,R;P<O;++P){if(S){if((R=T.charAt(P))==="}"){--S||(M.push(T.substring(J,P)),U.push(true))&&(J=P+1),Q=false}else{S+=R==="{"}}else{if((R=T.charAt(P))==="#"){Q=true}else{if(R==="{"&&Q){M.push(T.substring(J,P-1)),U.push(false),J=P+1,++S}else{Q=false}}}}M.push(T.substring(J,O)),U.push(false);for(var K=new RegExp("\\\\"+I,"g"),P=0,O=M.length;P<O;++P){M[P]=U[P]?this(a.parse(M[P].replace(K,I)).as("(")):new N(I+M[P]+I)}return new N("+",M).unflatten().as("(")};var F=a.rereplacer("_left(_args) = _right","_left = (function (_args) {return _right})"),d=a.rereplacer("_left(_var = arguments) = _right","_left = (function () {var _var = arguments; return _right})"),w=function(I){return d.call(this,I)||F.call(this,I)};var D=a.rereplacer("_x /-_f/ _y","_f(_x, _y)"),i=a.rereplacer("_x |-_f| _y","_f(_x, _y)"),m=function(K){var N=K.data,J,O;if((N==="/"||N==="|")&&(J=K[0]).data===N&&J[1]&&J[1].data==="u~"&&(O=J[1][0])){for(var Q=new a.syntax(","),I=this(J[0]);I.data===N;I=I[0]){Q.push(I[1])}Q.push(I);for(var M=0,L=Q.length,P;M<L>>1;++M){P=Q[M],Q[M]=Q[L-M-1],Q[L-M-1]=P}return new a.syntax("()",O,Q.push(this(K[1])).unflatten())}},y=function(I){return m.call(this,I)||D.call(this,I)||i.call(this,I)};var k=a.rereplacer("_x /!_f","_f(_x)");var o=a.pattern("_literal._modifier"),G=function(J,K,I){var L=J.literal_modifiers[K];return L.hasOwnProperty(I)&&L[I]},u=function(K){var J=o.call(this,K),I,L;if(J&&(I=J._literal)&&(L=I.is_identifier()?G(this,"identifier",J._modifier.data):I.is_array()?G(this,"array",J._modifier.data):I.is_regexp()?G(this,"regexp",J._modifier.data):I.is_number()?G(this,"number",J._modifier.data):I.is_string()?G(this,"string",J._modifier.data):null)){return L.call(this,I)}};var A=a.pattern("_modifier[_expression]"),l=a.pattern("_expression /_modifier"),C=a.pattern("_expression -_modifier"),H=a.pattern("_modifier in _expression"),z=a.pattern("_expression |_modifier"),B=a.pattern("_expression, _modifier"),v=a.pattern("_modifier._parameters"),q=a.pattern("_modifier[_parameters]"),E=a.pattern("_expression <_modifier> _parameters"),h=a.pattern("_expression -_modifier- _parameters"),b=function(N){var I=E.call(this,N)||h.call(this,N);if(I){for(var O=this.parameterized_modifiers,L=O.length-1,M;L>=0;--L){if(M=O[L].call(this,I)){return M}}}var K=A.call(this,N)||l.call(this,N)||C.call(this,N)||H.call(this,N)||z.call(this,N)||B.call(this,N);if(K){var J=v.call(this,K._modifier)||q.call(this,K._modifier);if(J){K._modifier=J._modifier;K._parameters=J._parameters;for(var O=this.parameterized_modifiers,L=O.length-1,M;L>=0;--L){if(M=O[L].call(this,K)){return M}}}else{for(var O=this.modifiers,L=O.length-1,M;L>=0;--L){if(M=O[L].call(this,K)){return M}}}}};var g=function(I){return j.call(this,I)||u.call(this,I)||I.length&&(b.call(this,I)||w.call(this,I)||y.call(this,I)||k.call(this,I))},s=c?a(function(I){return c.call(this,I)||g.call(this,I)}):a(g);s.modifiers=[];s.parameterized_modifiers=[];s.literal_modifiers={regexp:{},array:{},string:{},number:{},identifier:{}};return s}})(caterwaul);(function(a){a.js_literals=function(c){var b=a.parse("function (_) {return _body}");(function(d){d.x=a.reexpander(function(h){return h.with_data(h.data.replace(/\s+/g,""))});var g=a.parse("_regexp.exec(_)");d.qf=function(h){return b.replace({_body:g.replace({_regexp:h})})}})(c.literal_modifiers.regexp);(function(d){d.qw=a.reexpander(function(o){for(var q=new a.syntax("["),g=new a.syntax(","),j=o.data.charAt(0),m=o.as_escaped_string().split(/\s+/),k=0,h=m.length;k<h;++k){g.push(new a.syntax(j+m[k]+j))}return q.push(g.unflatten())});d.qh=a.reexpander(function(o){for(var q=new a.syntax("{"),g=new a.syntax(","),j=o.data.charAt(0),m=o.as_escaped_string().split(/\s+/),k=0,h=m.length;k<h;k+=2){g.push(new a.syntax(":",new a.syntax(j+m[k]+j),new a.syntax(j+m[k+1]+j)))}return q.push(g.unflatten())});d.qr=a.reexpander(function(g){return g.with_data("/"+g.as_escaped_string().replace(/\//g,"\\/")+"/")});d.qs=function(g){return new a.ref(a.parse(g.as_unescaped_string()))};d.qf=a.reexpander(function(g){return b.replace({_body:a.parse(g.as_unescaped_string())})})})(c.literal_modifiers.string);return c}})(caterwaul);(function(a){a.words=function(d){var h=function(i,j){return function(k){return k._modifier.data===i&&j.call(this,k)}},b=function(i,j){d.modifiers.push(h(i,j))},g=function(i,j){d.parameterized_modifiers.push(h(i,j))};b("qs",function(i){return new a.ref(i._expression,"qs")});b("qse",function(i){return new a.ref(this(i._expression),"qse")});b("reexpand",function(i){return this(this(i._expression))});b("noexpand",function(i){return i._expression});b("raise",a.reexpander("(function () {throw _expression}).call(this)"));g("rescue",a.reexpander("(function () {try {return (_expression)} catch (e) {return (_parameters)}}).call(this)"));b("eval",function(i){return new a.ref(a.compile(this(i._expression)),"eval")});g("given",a.reexpander("(function (_parameters) {return _expression})"));g("bgiven",a.reexpander("(function (t, f) {return (function () {return f.apply(t, arguments)})})(this, (function (_parameters) {return _expression}))"));b("delay",a.reexpander("(function (t, f) {return (function () {return f.call(t)})})(this, (function () {return _expression}))"));b("lazy",a.reexpander("(function (t, f, v, vc) {return (function () {return vc ? v : (vc = true, v = f.call(t))})})(this, (function () {return _expression}))"));g("se",a.reexpander("(function (it) {return (_parameters), it}).call(this, (_expression))"));g("re",a.reexpander("(function (it) {return (_parameters)}).call(this, (_expression))"));g("where",a.reexpander("(function () {var _parameters; return (_expression)}).call(this)"));b("capture",function(m){for(var q=new a.syntax("{"),j=new a.syntax(","),s=m._expression.flatten(","),o=0,k=s.length;o<k;++o){j.push(this(s[o]).with_data(":"))}return q.push(j.unflatten())});var c=a.parse("(function () {var _variables; return _expression}).call(this)");g("using",a.reexpander(function(l){var m=a.compile(this(l._parameters)),i=new a.syntax(",");for(var j in m){if(Object.prototype.hasOwnProperty.call(m,j)){i.push(new a.syntax("=",j,new a.ref(m[j])))}}return c.replace({_variables:i.unflatten(),_expression:l._expression})}));g("when",a.reexpander("((_parameters) && (_expression))"));g("unless",a.reexpander("(! (_parameters) && (_expression))"));return d}})(caterwaul);caterwaul.words(caterwaul.js())(function(a){a.seq(caterwaul_function)=caterwaul_function-se-it.modifiers.push(given.match in seq_expand.call(seq_expand,anon_pattern.replace({_x:match._expression}))-re-this(it)/when.it-when[match._modifier.data==="seq"])-where[anon_pattern=anon("S[_x]"),seq_expand=a(a.alternatives(operator_macros.concat(word_macros)))],where[anon=a.anonymizer("S"),rule(p,e)=a.rereplacer(p.constructor===String?anon(p):p,e.constructor===String?anon(e):e),operator_macros=[rule("S[_x]","_x"),rule("S[_xs + _ys]",concat),rule("S[_xs ^ _ys]",zip),rule("S[_xs - _ys]",cross),rule("S[(_x)]","(S[_x])"),rule("S[_x[_y]]","S[_x][_y]"),rule("S[_xs(_ys)]","S[_xs](_ys)"),rule("S[[_x]]","[_x]"),rule("S[_x, _y]","S[_x], S[_y]"),rule("S[_xs._p]","S[_xs]._p"),rule("S[~[_x]]","[S[_x]]"),rule("S[_x ? _y : _z]","(S[_x]) ? (S[_y]) : (S[_z])"),rule("S[_x && _y]","(S[_x]) && (S[_y])"),rule("S[_x || _y]","(S[_x]) || (S[_y])"),rule("S[_xs %_thing]",handle_filter_forms),rule("S[_xs *_thing]",handle_map_forms),rule("S[_xs /_thing]",handle_fold_forms),rule("S[_xs |_thing]",handle_exists_forms),rule("S[_xs %k*_thing]",handle_kmap_forms),rule("S[_xs %v*_thing]",handle_vmap_forms),rule("S[_xs %k%_thing]",handle_kfilter_forms),rule("S[_xs %v%_thing]",handle_vfilter_forms)]-where[unrecognized(reason)=raise[new Error(reason)],use_form(form,xs,body,init,vars)=form?form.replace({_f:body,_init:init}).replace(a.merge({_xs:xs},vars)):unrecognized("unsupported sequence operator or modifiers used on #{body}"),operator_case(forms)(match)=parse_modifiers(match._thing,use(forms.normal,forms.inormal),use(forms.bang,forms.ibang),use(forms.tbang,forms.itbang))-where[xs=match._xs,expander=this,form_function(form)(body,vars)=use_form(form,xs,body,null,vars),iform_function(form)(body,init,vars)=use_form(form,xs,body,init,vars),use(form,iform)(body)=parse_body(body,expander,form_function(form),iform_function(iform))],handle_map_forms=operator_case({normal:map,bang:each,tbang:flatmap}),handle_filter_forms=operator_case({normal:filter,bang:filter_not,tbang:map_filter}),handle_fold_forms=operator_case({normal:foldl,bang:foldr,tbang:unfold,inormal:ifoldl,ibang:ifoldr}),handle_kmap_forms=operator_case({normal:kmap,bang:keach}),handle_kfilter_forms=operator_case({normal:kfilter,bang:kfilter_not,tbang:kmap_filter}),handle_vmap_forms=operator_case({normal:vmap,bang:veach}),handle_vfilter_forms=operator_case({normal:vfilter,bang:vfilter_not,tbang:vmap_filter}),handle_exists_forms=operator_case({normal:exists}),block=anon("[_x]"),block_with_variable=anon("_var[_x]"),block_with_init=anon("[_init][_x]"),block_with_variable_and_init=anon("_var[_init][_x]"),block_with_closure=anon("+_x"),block_with_seq=anon("~_x"),standard_names={_x:"x",_x0:"x0",_xi:"xi",_xl:"xl"},prefixed_names(p)={_x:p,_x0:"#{p}0",_xi:"#{p}i",_xl:"#{p}l"},function_promotion=anon("_f(_x, _x0, _xi, _xl)"),promote_function(f)=function_promotion.replace({_f:f}),closure_wrapper=anon("(function (_x, _x0, _xi, _xl) {return _f}).call(this, _x, _x0, _xi, _xl)"),close_body(vars,f)=closure_wrapper.replace(vars).replace({_f:f}),seq_pattern=anon("S[_x]"),promote_seq(f)=seq_pattern.replace({_x:f}),parse_body(tree,expand,normal,init)=((r=block_with_seq.match(tree))?parse_body(r._x,expand,sequence_context_normal,sequence_context_init):(r=block_with_closure.match(tree))?parse_body(r._x,expand,wrapping_normal,wrapping_init):(r=block_with_variable_and_init.match(tree))?init(r._x,r._init,prefixed_names(r._var)):(r=block_with_init.match(tree))?init(r._x,r._init,standard_names):(r=block_with_variable.match(tree))?normal(r._x,prefixed_names(r._var)):(r=block.match(tree))?normal(r._x,standard_names):normal(promote_function(tree),standard_names))-where[in_sequence_context(f)=expand.call(expand,promote_seq(f)),sequence_context_normal(f,names)=normal(in_sequence_context(f),names),sequence_context_init(f,init_expression,names)=init(in_sequence_context(f),init_expression,names),wrapping_normal(f,names)=normal(close_body(names,f),names),wrapping_init(f,init_expression,names)=init(close_body(names,f),init_expression,names),r=null],tbang_modifier=anon("~!_x"),bang_modifier=anon("!_x"),parse_modifiers(tree,normal,bang,tbang)=((result=tbang_modifier.match(tree))?tbang(result._x):(result=bang_modifier.match(tree))?bang(result._x):normal(tree))-where[result=null]]-where[loop_anon=a.anonymizer("xs","ys","x","y","i","j","l","lj","r","o","k"),scope=anon("(function (xs) {var _x, _x0, _xi, _xl; _body}).call(this, S[_xs])"),scoped(t)=scope.replace({_body:t}),form(x)=loop_anon(scoped(anon(x))),map=form("for (var ys = [], _xi = 0, _xl = xs.length;     _xi < _xl; ++_xi) _x = xs[_xi], ys.push((_f));                             return ys"),each=form("for (var          _xi = 0, _xl = xs.length;     _xi < _xl; ++_xi) _x = xs[_xi], (_f);                                      return xs"),flatmap=form("for (var ys = [], _xi = 0, _xl = xs.length;     _xi < _xl; ++_xi) _x = xs[_xi], ys.push.apply(ys, ys.slice.call((_f)));    return ys"),filter=form("for (var ys = [], _xi = 0, _xl = xs.length;     _xi < _xl; ++_xi) _x = xs[_xi], (_f) && ys.push(_x);                       return ys"),filter_not=form("for (var ys = [], _xi = 0, _xl = xs.length;     _xi < _xl; ++_xi) _x = xs[_xi], (_f) || ys.push(_x);                       return ys"),map_filter=form("for (var ys = [], _xi = 0, _xl = xs.length, _y; _xi < _xl; ++_xi) _x = xs[_xi], (_y = (_f)) && ys.push(_y);                return ys"),foldl=form("for (var _x0 = xs[0], _xi = 1, _xl = xs.length;            _xi < _xl; ++_xi) _x = xs[_xi], _x0 = (_f);                     return _x0"),foldr=form("for (var _xl = xs.length, _xi = _xl - 2, _x0 = xs[_xl - 1]; _xi >= 0; --_xi) _x = xs[_xi], _x0 = (_f);                     return _x0"),unfold=form("for (var ys = [], _x = xs, _xi = 0;                     _x !== null; ++_xi) ys.push(_x), _x = (_f);                        return ys"),ifoldl=form("for (var _x0 = (_init), _xi = 0, _xl = xs.length;      _xi < _xl; ++_xi) _x = xs[_xi], _x0 = (_f);                         return _x0"),ifoldr=form("for (var _xl = xs.length - 1, _xi = _xl, _x0 = (_init); _xi >= 0; --_xi) _x = xs[_xi], _x0 = (_f);                         return _x0"),exists=form("for (var _x = xs[0], _xi = 0, _xl = xs.length, x; _xi < _xl; ++_xi) {_x = xs[_xi]; if (x = (_f)) return x} return false"),concat=anon("(S[_xs]).concat((S[_ys]))"),zip=form("for (var ys = (S[_ys]), pairs = [], i = 0, l = xs.length; i < l; ++i) pairs.push([xs[i], ys[i]]); return pairs"),cross=form("for (var ys = (S[_ys]), pairs = [], i = 0, l = xs.length, lj = ys.length; i < l; ++i) for (var j = 0; j < lj; ++j) pairs.push([xs[i], ys[j]]);return pairs"),kmap=form("var r = {};    for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x)) r[_f] = xs[_x];                        return r"),keach=form("               for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x)) _f;                                    return xs"),kfilter=form("var r = {};    for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x) &&      (_f))  r[_x] = xs[_x];          return r"),kfilter_not=form("var r = {};    for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x) &&    ! (_f))  r[_x] = xs[_x];          return r"),kmap_filter=form("var r = {}, x; for (var _x in xs) if (Object.prototype.hasOwnProperty.call(xs, _x) && (x = (_f))) r[x]  = xs[_x];          return r"),vmap=form("var r = {};    for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k], r[k] = (_f);                return r"),veach=form("               for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k], _f;                         return xs"),vfilter=form("var r = {};    for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k],        (_f) && (r[k] = _x); return r"),vfilter_not=form("var r = {};    for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k],        (_f) || (r[k] = _x); return r"),vmap_filter=form("var r = {}, x; for (var  k in xs) if (Object.prototype.hasOwnProperty.call(xs, k)) _x = xs[k], x = (_f), x && (r[k] =  x); return r")],word_macros=[rule("S[n[_upper]]",n),rule("S[ni[_upper]]",ni),rule("S[_o /keys]",keys),rule("S[_o |object]",object),rule("S[n[_lower, _upper]]",n),rule("S[ni[_lower, _upper]]",ni),rule("S[_o /values]",values),rule("S[_o -object]",object),rule("S[n[_lower, _upper, _step]]",n),rule("S[ni[_lower, _upper, _step]]",ni),rule("S[_o /pairs]",pairs),rule("S[_o /object]",object)]-where[n(match)=n_pattern.replace(a.merge({_lower:"0",_step:"1"},match)),ni(match)=ni_pattern.replace(a.merge({_lower:"0",_step:"1"},match)),n_pattern=anon("(function (i, u, s) {if ((u - i) * s <= 0) return [];for (var r = [], d = u - i; d > 0 ? i <  u : i >  u; i += s) r.push(i); return r})((_lower), (_upper), (_step))"),ni_pattern=anon("(function (i, u, s) {if ((u - i) * s <= 0) return [];for (var r = [], d = u - i; d > 0 ? i <= u : i >= u; i += s) r.push(i); return r})((_lower), (_upper), (_step))"),scope=anon("(function (o) {_body}).call(this, (S[_o]))"),scoped(t)=scope.replace({_body:t}),form(p)=tree.replace(match)-given.match-where[tree=scoped(anon(p))],keys=form("var ks = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ks.push(k); return ks"),values=form("var vs = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && vs.push(o[k]); return vs"),pairs=form("var ps = []; for (var k in o) Object.prototype.hasOwnProperty.call(o, k) && ps.push([k, o[k]]); return ps"),object=form("for (var r = {}, i = 0, l = o.length, x; i < l; ++i) x = o[i], r[x[0]] = x[1]; return r")]]})(caterwaul);caterwaul.js_all=function(){return this.seq(this.words(this.js_literals(this.js())))}})();(caterwaul.ui_initializer=function(){caterwaul.words(caterwaul.js())(function(a){a.jquery(caterwaul_function)=caterwaul_function-se-it.modifiers.push(given.match in jquery_expand.call(jquery_expand,anon_pattern.replace({_x:match._expression}))-re-this(it)/when.it-when[match._modifier.data==="jquery"])-where[anon_pattern=anon("J[_x]"),jquery_expand=a(a.alternatives(jquery_macros.concat(string_macros).concat(search_macros)))],where[jq="jQuery",anon=a.anonymizer("J","TS","S","P","PS"),hyphenate(s)=s.replace(/_/g,"-"),rule(p,e)=a.rereplacer(anon(p),e.constructor===Function?e.call(this,match)-given.match:anon(e)),p=where[p_pattern=anon("P[_thing]")] in p_pattern.replace({_thing:node})-given.node,jquery_macros=[rule("J[_element]",given.match[match._element.is_constant()||match._element.length?wrap_in_jquery(match):become_dom_node(match)]),rule("J[_element._class]","J[_element].addClass(S[_class])"),rule("J[_element *_attr(_val)]","J[_element].attr(S[_attr], _val)"),rule("J[_element *!_name(_val)]","J[_element].data(S[_name], _val)"),rule("J[_element /_method(_args)]","J[_element]._method(_args)"),rule("J[_element /!_event(_args)]","J[_element].bind(S[_event], _args)"),rule("J[_element %_function]","_function(J[_element])"),rule("J[_element(_children)]","J[_element].append(J[_children])"),rule("J[_element[_children]]","J[_element].append(_children)"),rule("J[_element > _child]","J[_element].append(J[_child])"),rule("J[_element >= _child]","J[_element].append(_child)"),rule("J[_element1, _element2]","J[_element1].add(J[_element2])"),rule("J[_element1 + _element2]","J[_element1].add(J[_element2])"),rule("J[_element >> _pattern]","J[_element].filter(PS[_pattern])"),rule("J[_element >>> _pattern]","J[_element].find(PS[_pattern])"),rule("J[_element << _pattern]","J[_element].parents(PS[_pattern])"),rule("J[(_element)]","(J[_element])"),rule("J[[_element]]","[J[_element]]"),rule("J[+_expression]","_expression")]-where[dom_node_template=anon("#{jq}(TS[_element])"),jquery_template=anon('#{jq}("<span>" + (_element) + "</span>")'),become_dom_node(match)=dom_node_template.replace(match),wrap_in_jquery(match)=jquery_template.replace(match)],string_macros=[rule("TS[_identifier]",string("<#{hyphenate(match._identifier.data)}>")-given.match),rule("S[_identifier]",string(hyphenate(match._identifier.data))-given.match),rule("PS[_identifier]",string(expand(p(match._identifier)).data)-given.match)]-where[string(s)=new a.syntax('"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"')],search_macros=[rule("P[_element]",new a.syntax(hyphenate(match._element.data-re[it==="_"?"*":it]))-given.match),rule("P[_element._class]",new a.syntax("#{this(p(match._element)).data}.#{hyphenate(match._class.data)}")-given.match),rule("P[_element[_attributes]]",new a.syntax("#{this(p(match._element)).data}[#{this(p(match._attributes))}]")-given.match),rule("P[_attribute = _value]",new a.syntax('#{this(p(match._attribute)).data}="#{'+interpolated(match._value)+'}"')-given.match),rule("P[(_element)]","P[_element]"),rule("P[_element1 +   _element2]",binary(", ")),rule("P[_element1,    _element2]",binary(", ")),rule("P[_element1 >>  _element2]",binary(" ")),rule("P[_element1 >>> _element2]",binary(" ")),rule("P[_element1 >   _element2]",binary(" > ")),rule("P[_element1(_element2)]",binary(" > ")),rule("P[_element /_selector]",new a.syntax("#{expand(p(match._element)).data}:#{hyphenate(match._selector.data)}")-given.match),rule("P[_element /_selector(_value)]",new a.syntax('#{expand(p(match._element)).data}:#{hyphenate(match._selector.data)}("#{'+interpolated(match._value)+'}")')-given.match)]-where[interpolated(node)='(#{node.toString()}).replace(/(\\)/g, "$1$1").replace(/(")/g, "\\$1")',binary(op)(match)=new a.syntax("#{expand(p(match._element1)).data}#{op}#{expand(p(match._element2)).data}")]]})(caterwaul)})();